# 广告审核AI工具（便携版）

## 项目概述

这是一个基于嵌入式Python 3.13.12的广告审核AI工具便携版本，集成了抖音视频分析、语音识别、内容审核等功能。

## 文件结构

```
AdAuditAI-Portable/
├── python-3.13-embed/      # 嵌入式Python 3.13.12 (约650MB)
├── src/                    # 源代码目录 (约1.3MB)
│   ├── api/               # API接口
│   ├── core/              # 核心功能
│   ├── douyin_analyzer/   # 抖音分析器
│   ├── install/           # 安装模块
│   ├── packaging/         # 打包模块
│   ├── pool/              # 会话池
│   ├── service/           # 服务模块
│   ├── session_crawler/   # 会话爬虫
│   ├── static/            # 静态资源
│   ├── templates/         # HTML模板
│   └── whisper_service/   # Whisper语音服务
├── models/                # 模型文件 (约211MB)
│   └── whisper/
│       ├── base.pt       # Whisper基础精度模型 (138.5MB)
│       └── tiny.pt       # Whisper快速低精度模型 (72.1MB)
├── browsers/              # 浏览器文件 (约200MB)
│   └── chromium-1208/
│       └── chrome-win/   # Chromium浏览器完整文件
├── config.py             # 配置文件
├── deps_config.py       # 依赖配置
├── start.bat            # 标准启动器
├── main.py              # 主程序
├── requirements.txt     # 依赖列表
├── sessions.json        # 会话配置文件
├── check_playwright.py  # Playwright浏览器检查脚本
├── 使用指南.txt          # 中文使用指南
└── README.md           # 本文件
```

## 快速启动

双击 `start.bat` 启动程序

## 启动流程

1. 自动检测嵌入式Python
2. 创建虚拟环境（如不存在）
3. 安装所需依赖包
4. 启动Web服务
5. 浏览器自动打开：http://localhost:8000

## 系统要求

- **操作系统**: Windows 7/10/11（64位）
- **内存**: 至少4GB可用内存
- **存储**: 至少2GB可用磁盘空间
- **显卡**: 无需NVIDIA显卡，纯CPU版本兼容任何电脑
- **网络**: 稳定网络连接（首次运行需下载依赖）
- **Python**: 无需单独安装，已内置嵌入式Python 3.13.12

## 功能特性

1. **抖音视频分析**：自动提取视频内容、音频、字幕
2. **语音识别**：使用Whisper模型进行语音转文字
3. **内容审核**：基于规则的广告内容检测
4. **多账号管理**：支持多个抖音账号并行处理
5. **Web界面**：友好的图形化操作界面
6. **Session抓取**：豆包AI会话管理，支持多会话负载均衡
7. **离线浏览器**：内置Chromium浏览器，Session抓取无需网络下载

## 注意事项

1. **首次启动**：可能需要5-10分钟下载依赖和模型
2. **杀毒软件**：如遇拦截请添加到信任列表
3. **网络要求**：需要访问抖音API和下载模型
4. **存储空间**：确保有至少2GB可用磁盘空间
5. **显卡兼容**：本版本使用纯CPU PyTorch，无需NVIDIA显卡，兼容任何电脑

## 故障排除

### 1. DLL加载失败
**错误**: `OSError: [WinError 1114] DLL初始化例程失败`
**解决**: 确保使用正确的启动器，已包含DLL路径修复

### 2. 虚拟环境创建失败
**错误**: `venv模块不可用`
**解决**: 启动器已内置virtualenv备用方案

### 3. 依赖安装失败
**错误**: `pip安装超时或失败`
**解决**: 检查网络连接，重启程序重试

### 4. 端口占用
**错误**: `端口8000已被占用`
**解决**: 关闭占用8000端口的程序，或修改config.py中的端口配置

## 技术支持

如有问题，请检查以下文件：
- `logs/` 目录下的日志文件
- 启动器输出的错误信息
- 浏览器开发者工具的控制台输出

## 打包分发

### 打包给他人使用
项目已配置为便携版本，可直接压缩整个文件夹分发给其他用户：

1. **压缩整个文件夹**：将 `AdAuditAI-Portable` 文件夹完整压缩为ZIP文件
2. **包含内容**：
   - 嵌入式Python 3.13.12（无需单独安装）
   - 所有源代码和配置文件
   - Whisper语音识别模型（tiny.pt）
   - 一键启动脚本（start.bat）
3. **分发说明**：
   - 接收者只需解压后双击 `start.bat` 启动程序
   - 首次启动会自动安装所有依赖（需网络连接）
   - 无需NVIDIA显卡，任何Windows电脑都能运行
4. **文件清单**：
   ```
   AdAuditAI-Portable/
   ├── python-3.13-embed/      # 嵌入式Python (650MB)
   ├── src/                    # 源代码 (1.3MB)
   ├── models/                 # 模型文件 (211MB)
   ├── browsers/               # 浏览器文件 (200MB)
   ├── config.py              # 配置文件
   ├── deps_config.py         # 依赖配置
   ├── requirements.txt       # 依赖列表
   ├── start.bat              # 标准启动器
   ├── main.py                # 主程序
   ├── check_playwright.py    # 浏览器检查脚本
   ├── sessions.json          # 会话配置文件
   ├── 使用指南.txt            # 中文使用指南
   └── README.md              # 说明文档
   ```

## 最新更新 (2026-02-10)

### 🔧 功能修复与优化
1. **语音识别转文字**：
   - **修复MP3音频文件损坏问题**：针对损坏的MP3文件头，增加三重修复机制
   - **优化音频处理兼容性**：支持损坏MP3文件的自动修复和转换
   - **增强音频时长获取**：四级时长获取策略，确保损坏文件也能处理
   - **解决MPEG音频头错误**：自动检测并修复"Illegal Audio-MPEG-Header"问题

2. **Whisper语音服务**：
   - **修复torchaudio兼容性问题**：替换已废弃的`torchaudio.info()`函数
   - **增加音频格式转换引擎**：支持pydub、torchaudio、librosa三种转换方式
   - **优化音频预处理流程**：自动检测MP3文件损坏并尝试修复
   - **增强错误处理机制**：提供更详细的音频处理错误日志

3. **抖音广告链接分析**：
   - 修复了会话配置获取逻辑，解决"会话配置不存在"错误
   - 优化豆包API调用参数，提高分析成功率
   - 支持单链接分析限制，移除批量分析功能

4. **视频审核系统**：
   - 更新专业抖音广告审核AI prompt，适配平台审核模式
   - 支持6个质量维度评估：创意吸引力、内容价值与韧性、信息清晰度、形式美观度、情境相关性、营销方式
   - 新增违规检测机制：A类严重违规、B类广告规范违规
   - 支持0-10分制评分，自动转换为0-100分制

5. **自动更新系统**：
   - 新增版本检查和自动更新功能
   - 支持后台静默更新，不影响用户使用
   - 更新失败自动回滚机制

6. **用户体验优化**：
   - **修复语音识别界面功能**：为历史记录添加删除按钮和重置功能
   - **增强语音识别用户体验**：添加"重新上传"按钮和ESC快捷键支持
   - **优化界面交互**：支持复制文本、下载文本等便捷操作
   - 修复start.bat启动脚本闪退问题
   - 优化错误处理和日志记录
   - 增强会话管理和账号轮询机制

7. **性能提升**：
   - 优化内存使用，减少资源占用
   - 改进缓存机制，提高分析速度
   - 增强多线程处理能力

8. **离线浏览器支持**：
   - 内置完整Chromium浏览器（约200MB）
   - Session抓取功能完全离线，无需网络下载
   - 自动检测并使用本地浏览器安装
   - 启动脚本优化，避免浏览器安装闪退问题

### 🚀 新功能特性
- **语音识别增强**：支持损坏MP3文件的自动修复和转录
- **音频格式兼容**：全面支持MP3、WAV、M4A、AAC、FLAC、OGG等格式
- **视频音频提取**：支持从MP4、AVI、MOV视频文件提取音频
- **热更新支持**：启动时添加`--reload`参数启用代码热更新
- **自动更新**：支持在线检查和安装更新包
- **会话测试**：新增豆包Session测试功能，验证会话有效性
- **历史记录管理**：抖音分析历史记录和语音识别历史记录支持删除操作

## 热更新使用说明

### 什么是热更新？
热更新（Hot Reload）是指在开发或调试过程中，当代码文件发生变化时，服务器能够自动重新加载代码，无需手动重启服务器。这极大地提高了开发效率。

### 如何启用热更新？
在启动程序时，只需在命令行中添加 `--reload` 参数即可启用热更新功能：

```bash
# 标准启动（无热更新）
start.bat

# 启用热更新启动
start.bat --reload
```

### 热更新适用场景
1. **开发调试**：修改HTML模板、CSS样式、JavaScript代码时，浏览器会自动刷新
2. **API调试**：修改Python后端代码时，API接口会自动重新加载
3. **配置调整**：修改配置文件后，无需重启整个应用程序
4. **快速测试**：进行小范围代码调整时，节省重启时间

### 热更新支持的文件类型
- ✅ Python源代码文件（.py）
- ✅ HTML模板文件（.html）
- ✅ CSS样式文件（.css）
- ✅ JavaScript文件（.js）
- ✅ 配置文件（config.py, deps_config.py）
- ✅ 静态资源文件

### 热更新注意事项
1. **性能影响**：热更新会轻微增加内存使用，生产环境建议关闭
2. **文件监控**：仅监控项目目录下的文件变化
3. **重启需求**：某些重大更改（如依赖库安装）仍需完全重启
4. **兼容性**：与自动更新系统完全兼容

### 使用示例
```bash
# 1. 首次启动（标准模式）
双击 start.bat

# 2. 开发模式启动（启用热更新）
# 编辑 start.bat，在最后一行添加 --reload 参数
# 或直接运行：python main.py --reload

# 3. 生产环境启动（关闭热更新）
# 保持 start.bat 原样运行即可
```

## 版本信息

- **版本**: 1.2.0 (第一版稳定版)
- **Python**: 3.13.12（嵌入式）
- **框架**: FastAPI + Uvicorn
- **核心模型**: Whisper 20250625 + PyTorch 2.9.1 CPU-only
- **语音识别**: openai-whisper 20250625（最新稳定版） + librosa 0.11.0
- **音频处理**: torchaudio 2.10.0 + pydub（可选）+ soundfile 0.13.1
- **深度学习**: PyTorch 2.9.1+cpu（纯CPU版本，无需NVIDIA显卡）
- **兼容性**: 支持任何Windows电脑，无需NVIDIA驱动
- **更新日期**: 2026-02-10

## 免责声明

本工具仅供学习和研究使用，请遵守相关法律法规和平台使用条款。